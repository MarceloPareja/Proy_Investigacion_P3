flowchart TD
    A["ğŸ“Š Evento de sistema<br/>ocurre<br/>(create, update, delete, etc.)"] --> B["â²ï¸ Capturar timestamp"]
    B --> C["ğŸ‘¤ Capturar usuario<br/>que realizÃ³ acciÃ³n"]
    C --> D["ğŸ“ Capturar IP address<br/>y user agent"]
    
    D --> E["ğŸ” Obtener detalles<br/>de entidad modificada"]
    E --> F{" Â¿QuÃ© tipo de<br/>evento?"}
    
    F -->|CREATE| G["âœï¸ Registrar:<br/>- Usuario creador<br/>- Datos iniciales<br/>- Timestamp"]
    F -->|UPDATE| H["âœï¸ Registrar:<br/>- Usuario que editÃ³<br/>- Datos anteriores<br/>- Datos nuevos<br/>- Campo modificado"]
    F -->|DELETE| I["âœï¸ Registrar:<br/>- Usuario que eliminÃ³<br/>- Datos eliminados<br/>- RazÃ³n (si aplica)"]
    F -->|DOWNLOAD| J["âœï¸ Registrar:<br/>- Usuario<br/>- Archivo descargado<br/>- Cantidad descargas"]
    
    G --> K["ğŸ” Calcular hash<br/>de datos para<br/>integridad"]
    H --> K
    I --> K
    J --> K
    
    K --> L["ğŸ’¾ Guardar registro<br/>en tabla AUDIT_LOG"]
    L --> M["â° Indexar por timestamp<br/>y usuario"]
    M --> N{" Â¿Evento crÃ­tico?<br/>(delete, acceso<br/>cambios crÃ­ticos)"}
    
    N -->|SÃ­| O["ğŸš¨ Enviar alerta<br/>a administrador"]
    N -->|No| P["âœ… Log completado"]
    
    O --> Q["ğŸ“§ Email notificaciÃ³n<br/>acciÃ³n crÃ­tica detectada"]
    Q --> P
    
    P --> R["ğŸ“‹ Consultas de audit:<br/>- Listar por usuario<br/>- Listar por entidad<br/>- Listar por fecha<br/>- Buscar cambios especÃ­ficos"]
    
    R --> S["ğŸ“Š Reporte de audit:<br/>- Exportar CSV<br/>- Exportar PDF<br/>- Visualizar timeline"]
    
    S --> T["âœ… Audit completado"]
    
    style A fill:#fff9c4
    style B fill:#b2dfdb
    style C fill:#b2dfdb
    style D fill:#b2dfdb
    style E fill:#b2dfdb
    style F fill:#c8e6c9
    style G fill:#e1bee7
    style H fill:#e1bee7
    style I fill:#ffcdd2
    style J fill:#b2dfdb
    style K fill:#b2dfdb
    style L fill:#81d4fa
    style M fill:#81d4fa
    style N fill:#c8e6c9
    style O fill:#ffccbc
    style P fill:#c8e6c9
    style Q fill:#81d4fa
    style R fill:#b2dfdb
    style S fill:#b2dfdb
    style T fill:#c8e6c9
