flowchart TD
    A["ğŸ”” Evento desencadena<br/>notificaciÃ³n<br/>(paper enviado, revisiÃ³n recibida, etc.)"] --> B["ğŸ“¤ Cola de eventos<br/>asincronos"]
    B --> C["âš™ï¸ Worker Celery<br/>procesa evento"]
    C --> D{" Â¿Tipo de<br/>evento?"}
    
    D -->|Paper Enviado| E["ğŸ“§ Obtener email<br/>del Administrador"]
    D -->|RevisiÃ³n Completada| F["ğŸ“§ Obtener emails<br/>de otros revisores"]
    D -->|DecisiÃ³n Tomada| G["ğŸ“§ Obtener email<br/>del Autor"]
    D -->|Recordatorio| H["â° Email de<br/>recordatorio"]
    
    E --> I["ğŸ“ Renderizar<br/>template email<br/>con contexto"]
    F --> I
    G --> I
    H --> I
    
    I --> J["ğŸ” Validar<br/>direcciÃ³n email"]
    J --> K{" Â¿Email<br/>vÃ¡lido?"}
    
    K -->|No| L["âŒ Logging error<br/>email invÃ¡lido"]
    K -->|SÃ­| M["ğŸ” Verificar<br/>preferencias usuario"]
    
    M --> N{" Â¿Usuario<br/>desuscrito?"}
    N -->|SÃ­| O["â­ï¸ Saltar envÃ­o"]
    N -->|No| P["ğŸ“¶ Conectar<br/>a SMTP server"]
    
    P --> Q["âœ‰ï¸ Enviar email<br/>vÃ­a SMTP"]
    Q --> R{" Â¿EnvÃ­o<br/>exitoso?"}
    
    R -->|SÃ­| S["âœ… Logging: Ã©xito"]
    R -->|No| T["ğŸ”„ Reintentar<br/>en 5 minutos<br/>(mÃ¡x 3 intentos)"]
    
    T --> U{" Â¿Reintentos<br/>agotados?"}
    U -->|SÃ­| L
    U -->|No| P
    
    S --> V["ğŸ“Š Actualizar<br/>estadÃ­sticas"]
    L --> V
    O --> V
    
    V --> W["ğŸ NotificaciÃ³n<br/>completada"]
    
    style A fill:#fff9c4
    style B fill:#fff9c4
    style C fill:#fff9c4
    style D fill:#c8e6c9
    style E fill:#e1bee7
    style F fill:#e1bee7
    style G fill:#e1bee7
    style H fill:#e1bee7
    style I fill:#b2dfdb
    style J fill:#b2dfdb
    style K fill:#c8e6c9
    style M fill:#b2dfdb
    style N fill:#c8e6c9
    style P fill:#81d4fa
    style Q fill:#81d4fa
    style R fill:#c8e6c9
    style S fill:#c8e6c9
    style T fill:#ffccbc
    style U fill:#c8e6c9
    style L fill:#ffcdd2
    style O fill:#ffccbc
    style V fill:#b2dfdb
