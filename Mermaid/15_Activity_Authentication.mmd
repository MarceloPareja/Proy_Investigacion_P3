flowchart TD
    A["ğŸ‘¤ Usuario accede<br/>al portal"] --> B{" Â¿Usuario<br/>autenticado?"}
    
    B -->|No| C["ğŸ” Mostrar pÃ¡gina<br/>de login"]
    B -->|SÃ­| W["âœ… Acceso concedido"]
    
    C --> D["ğŸ“§ Usuario ingresa<br/>email y contraseÃ±a"]
    D --> E["ğŸ“¤ POST /auth/login"]
    E --> F{" Â¿Credenciales<br/>vÃ¡lidas?"}
    
    F -->|No| G["âŒ Erro: Credenciales<br/>invÃ¡lidas"]
    G --> H["â±ï¸ Aumentar contador<br/>intentos fallidos"]
    H --> I{" Â¿Intentos<br/>\n> 5?"}
    I -->|SÃ­| J["ğŸ”’ Bloquear cuenta<br/>por 30 minutos"]
    I -->|No| C
    J --> K["ğŸ“§ Email alerta<br/>intento acceso no autorizado"]
    K --> C
    
    F -->|SÃ­| L["âœ… Credenciales<br/>correctas"]
    L --> M["ğŸ”“ Desbloq. contador<br/>si estaba bloqueado"]
    M --> N["ğŸ« Generar JWT token<br/>(exp: 24 horas)"]
    
    N --> O["ğŸ”’ Generar refresh token<br/>(exp: 7 dÃ­as)"]
    O --> P["ğŸ’¾ Guardar en sesiÃ³n<br/>Redis"]
    P --> Q["ğŸ” Enviar tokens<br/>HTTP-only cookies"]
    Q --> R["âœ… Redirect a dashboard"]
    
    R --> S{" Â¿Usuario<br/>intentÃ³ acceder<br/>recurso protegido?"}
    
    S -->|No| W
    S -->|SÃ­| T["ğŸ” Verificar JWT token"]
    T --> U{" Â¿Token<br/>vÃ¡lido?"}
    
    U -->|No| V["âŒ 401 Unauthorized"]
    U -->|SÃ­| X{" Â¿Permisos<br/>suficientes?"}
    X -->|No| Y["âŒ 403 Forbidden"]
    X -->|SÃ­| Z["âœ… Acceso al recurso"]
    
    V --> AA["ğŸ”„ Refrescar token<br/>con refresh token"]
    Y --> AA
    AA --> AB{" Â¿Refresh<br/>vÃ¡lido?"}
    AB -->|SÃ­| T
    AB -->|No| AC["ğŸ” Forzar login<br/>nuevamente"]
    
    Z --> W
    AC --> C
    
    style A fill:#fff9c4
    style B fill:#c8e6c9
    style C fill:#81d4fa
    style D fill:#fff9c4
    style E fill:#b2dfdb
    style F fill:#c8e6c9
    style G fill:#ffcdd2
    style H fill:#ffccbc
    style I fill:#c8e6c9
    style J fill:#ffcdd2
    style K fill:#81d4fa
    style L fill:#c8e6c9
    style M fill:#b2dfdb
    style N fill:#b2dfdb
    style O fill:#b2dfdb
    style P fill:#b2dfdb
    style Q fill:#b2dfdb
    style R fill:#c8e6c9
    style S fill:#c8e6c9
    style T fill:#b2dfdb
    style U fill:#c8e6c9
    style V fill:#ffcdd2
    style W fill:#c8e6c9
    style X fill:#c8e6c9
    style Y fill:#ffcdd2
    style Z fill:#c8e6c9
    style AA fill:#ffccbc
    style AB fill:#c8e6c9
    style AC fill:#ffccbc
