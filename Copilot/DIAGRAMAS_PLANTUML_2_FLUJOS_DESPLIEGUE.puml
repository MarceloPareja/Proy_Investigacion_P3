'=== DIAGRAMA 9: FLUJO DE ACTIVIDAD - CICLO COMPLETO ===
@startuml Activity_CompleteCycle
title Flujo de Actividad: Ciclo Completo de Conferencia

start

:Administrador anuncia
"Call for Papers";
note right: Notificación pública

:Autores envían papers;
note right: Durante período abierto

:Administrador registra
y valida papers;
note right: Validación de formato

:En fecha X, Admin distribuye
papers a revisores;
note right: 3 revisores por paper

:Revisores evalúan papers
(período de 2-4 semanas);
note right: Generan informes

:Admin recopila evaluaciones
de los 3 revisores;
note right: Compilación de datos

:Comité toma decisiones;
note right: Basado en evaluaciones

if (¿Paper aceptado?) then (Sí)
    :Sin cambios requeridos?;
    if (¿Requiere cambios?) then (Sí)
        :Notificar cambios
        requeridos a autor;
        
        :Autor envía
        versión revisada;
        
        :Admin recibe
        versión final;
    else (No)
        :Notificar aceptación
        a autor;
    endif
else (No)
    :Notificar rechazo a autor;
    stop
endif

:Papers aceptados en
programa final;

:Admin construye
programa final;
note right: Sesiones, horarios

:Publicar programa;

:Conferencia comienza;

stop

@enduml


'=== DIAGRAMA 10: DIAGRAMA DE ACTIVIDADES - ENVÍO Y REVISIÓN ===
@startuml Activity_SubmitReview
title Diagrama de Actividades: Proceso de Revisión

start

:Revisor accede
a sistema;

:Ve lista de papers
asignados;

:Selecciona paper
a revisar;

:Lee paper y comentarios
de otros revisores;

:Completa formulario
de evaluación;
note right: 
Puntuación 1-10
Comentarios
Recomendación
end note

if (¿Todos los campos
completos?) then (No)
    :Mostrar error;
    :(volver a completar);
else (Sí)
endif

if (¿Guardar como borrador?) then (Sí)
    :Guardar como borrador;
    :Puede editar después;
else (No - Enviar)
    :Validar datos;
    
    if (¿Válido?) then (No)
        :Error;
        :(volver a editar);
    else (Sí)
        :Guardar en BD;
        
        :Generar evento
        ReviewSubmitted;
        
        :Log para auditoría;
        
        :Notificar a Admin;
    endif
endif

stop

@enduml


'=== DIAGRAMA 11: ARQUITECTURA DE DESPLIEGUE ===
@startuml Deployment_Architecture
title Diagrama de Despliegue: Kubernetes en Producción

node "Cluster Kubernetes" {
    node "Ingress Controller" {
        component nginx_ingress [nginx-ingress\n(Load Balancer)]
    }
    
    node "API Deployment" {
        component api_pod1 [Pod API 1\nDjango App]
        component api_pod2 [Pod API 2\nDjango App]
        component api_pod3 [Pod API 3\nDjango App]
    }
    
    node "Worker Deployment" {
        component worker_pod1 [Pod Worker 1\nCelery]
        component worker_pod2 [Pod Worker 2\nCelery]
    }
    
    node "Stateful Services" {
        database postgresql_primary [PostgreSQL Primary]
        database postgresql_replica [PostgreSQL Replica\n(Read-only)]
        database redis_cluster [Redis Cluster]
    }
    
    node "Queue Service" {
        component rabbitmq [RabbitMQ\n(Message Broker)]
    }
}

node "External Services" {
    cloud s3 [AWS S3\n(File Storage)]
    cloud email_service [SendGrid\n(Email Service)]
    cloud monitoring [Prometheus\n(Monitoring)]
}

' Relaciones de tráfico
nginx_ingress --> api_pod1: HTTP/HTTPS
nginx_ingress --> api_pod2: HTTP/HTTPS
nginx_ingress --> api_pod3: HTTP/HTTPS

api_pod1 --> postgresql_primary: SQL
api_pod2 --> postgresql_primary: SQL
api_pod3 --> postgresql_primary: SQL

api_pod1 --> postgresql_replica: SELECT
api_pod2 --> postgresql_replica: SELECT
api_pod3 --> postgresql_replica: SELECT

api_pod1 --> redis_cluster: KV
api_pod2 --> redis_cluster: KV
api_pod3 --> redis_cluster: KV

api_pod1 --> rabbitmq: Publish events
api_pod2 --> rabbitmq: Publish events
api_pod3 --> rabbitmq: Publish events

rabbitmq --> worker_pod1: Consume events
rabbitmq --> worker_pod2: Consume events

worker_pod1 --> email_service: Send emails
worker_pod2 --> email_service: Send emails

api_pod1 --> s3: Upload/Download files
api_pod2 --> s3: Upload/Download files

api_pod1 --> monitoring: Metrics
api_pod2 --> monitoring: Metrics
api_pod3 --> monitoring: Metrics

@enduml


'=== DIAGRAMA 12: SERVICIO DE NOTIFICACIONES (ASINCRÓNICO) ===
@startuml Activity_Notifications
title Flujo Asincrónico: Sistema de Notificaciones

start

:Evento en el sistema
(PaperSubmitted, etc);

:Service genera evento;

:Evento entra en
Event Queue;

:Event Listener
consume evento;

if (¿Tipo de evento?) then (PaperSubmitted)
    :NotificationService.onPaperSubmitted();
    :Envía email de confirmación;
    
else (ReviewSubmitted)
    :NotificationService.onReviewSubmitted();
    :Notifica Admin;
    
else (DecisionMade)
    :NotificationService.onDecisionMade();
    :Envía resultado a Autor;
    
else (DeadlineApproaching)
    :NotificationService.onDeadline();
    :Envía recordatorio;
endif

:Crear objeto Notification;

:Guardar en BD;

:Queue email job;

:Celery Worker recibe job;

:Conecta a Email Provider;

:Envía email;

if (¿Email enviado?) then (Sí)
    :Marcar como enviado;
else (No - Error)
    :Reintentar (3 intentos);
    :Si falla, marcar como fallido;
endif

:Log evento para auditoría;

stop

@enduml


'=== DIAGRAMA 13: DIAGRAMA DE INTEGRACIÓN ===
@startuml Integration_Services
title Integraciones Externas del Sistema

package "Sistema de Conferencias" {
    component SistemaPrincipal [
        **Sistema Principal**
        ----
        Backend API
        lógica de negocio
    ]
}

interface EmailAPI [
    <<interface>>
    Email Provider
]

interface StorageAPI [
    <<interface>>
    Cloud Storage
]

interface AnalyticsAPI [
    <<interface>>
    Analytics
]

interface AuthAPI [
    <<interface>>
    Auth Provider
]

component SendGrid [
    **SendGrid**
    SMTP/API
    Para emails
]

component AWS_S3 [
    **AWS S3**
    Para almacenamiento
    de papers
]

component MixPanel [
    **MixPanel**
    Eventos y análisis
]

component Auth0 [
    **Auth0**
    OAuth 2.0 / SAML
]

SistemaPrincipal --> EmailAPI: Envía notificaciones
EmailAPI --> SendGrid: SMTP

SistemaPrincipal --> StorageAPI: Guarda/obtiene archivos
StorageAPI --> AWS_S3: HTTP REST

SistemaPrincipal --> AnalyticsAPI: Rastreo eventos
AnalyticsAPI --> MixPanel: API REST

SistemaPrincipal --> AuthAPI: Autentica usuarios
AuthAPI --> Auth0: OAuth flow

@enduml


'=== DIAGRAMA 14: CAPAS DE SEGURIDAD ===
@startuml Activity_Security
title Arquitectura de Seguridad: Múltiples Capas

start

:Usuario intenta acceder;

:LAYER 1: HTTPS/TLS
¿Conexión segura?;
if (¿HTTPS válida?) then (No)
    :Rechazar conexión;
    stop
else (Sí)
endif

:LAYER 2: FIREWALL
¿IP permitida?;
if (¿En whitelist?) then (No)
    :Rate limit, rechazar;
    stop
else (Sí)
endif

:LAYER 3: AUTENTICACIÓN
¿JWT válido?;
if (¿Token válido?) then (No)
    :Rechazar, redirect login;
    stop
else (Sí)
endif

:LAYER 4: AUTORIZACIÓN
¿Usuario tiene rol?;
if (¿Role correcto?) then (No)
    :Forbidden 403;
    stop
else (Sí)
endif

:LAYER 5: VALIDACIÓN
¿Data válida?;
if (¿Input sanitizado?) then (No)
    :Error 400, log ataque;
    stop
else (Sí)
endif

:LAYER 6: LOGICA DE NEGOCIO
¿Lógica correcta?;
if (¿Autorizado?) then (No)
    :Forbidden, log;
    stop
else (Sí)
endif

:LAYER 7: BD
Execute con permisos DB;

:LAYER 8: AUDITORÍA
Log acción exitosa;

:Retornar resultado;

stop

@enduml


'=== DIAGRAMA 15: MATRIZ DE DECISIONES - ACEPTACIÓN ===
@startuml Activity_AcceptanceLogic
title Lógica de Decisión: Criterios de Aceptación

start

:Paper tiene 3 reviews;

:Calcular score promedio;

:Contar recomendaciones;
note right
ACCEPT = aceptar
REJECT = rechazar
REVIEW = revisar
end note

:Aceptaciones >= 2?;
if (Sí) then
    :Revisar score promedio;
    
    if (Score >= 7.0) then
        :DECISION = ACCEPTED;
    else if (Score >= 5.5) then
        :DECISION = CHANGES_REQUIRED;
        note right: Requiere mejoras
        end note
    else
        :DECISION = REJECTED;
    endif
    
else if (Rechazos >= 2) then
    :DECISION = REJECTED;
    
else
    :Decisión mixta;
    :Revisar comentarios;
    
    if (Consenso hacia aceptación?) then
        :DECISION = CHANGES_REQUIRED;
    else
        :DECISION = REJECTED;
    endif
endif

:Guardar decisión;

:Generar evento DecisionMade;

:Notificar autor;

stop

@enduml


'=== DIAGRAMA 16: CASOS DE USO (PRIMARIOS) ===
@startuml UseCase_Main
title Casos de Uso Principales

left to right direction

actor Autor
actor Revisor
actor Admin
actor Comité

package SistemaConferencia {
    usecase UC1 as "Enviar Paper"
    usecase UC2 as "Ver Estado Paper"
    usecase UC3 as "Recibir Paper"
    usecase UC4 as "Distribuir a Revisores"
    usecase UC5 as "Evaluar Paper"
    usecase UC6 as "Enviar Review"
    usecase UC7 as "Ver Reviews"
    usecase UC8 as "Seleccionar Papers"
    usecase UC9 as "Notificar Decisiones"
    usecase UC10 as "Construir Programa"
    usecase UC11 as "Revisar Versión Final"
}

Autor --> UC1: Acción
Autor --> UC2: Consulta
Admin --> UC3: Registra
Admin --> UC4: Acciona
Revisor --> UC5: Accede a
Revisor --> UC6: Ejecuta
Admin --> UC7: Consulta
Comité --> UC8: Realiza
Admin --> UC9: Dispara
Admin --> UC10: Ejecuta
Autor --> UC11: Participa en

UC3 ..> UC4: precede
UC4 ..> UC5: precede
UC5 ..> UC6: precede
UC6 ..> UC7: precede
UC7 ..> UC8: informa
UC8 ..> UC9: genera
UC9 ..> UC11: lleva a
UC11 ..> UC10: precede

@enduml
